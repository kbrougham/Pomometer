<tr>
  <td><h1>Current Milestones</h1></td>
  <td>
    <% if session[:admin_id] != nil %>
      <h4 style="text-align:left"><%= link_to 'New Milestone', new_milestone_path %></h4>
    <% end %>
  </td>
</tr>
  <td colspan='2' style="text-align:center">
  <%= time_zone_select( "user", "time_zone", nil, default: session[:selected_time_zone] )%>
</td> 
<tr>
</tr>

<table class='milestones_main'>

  <% if @milestones.empty? %>
    <tr>
      <td>
        <h2 style="text-align:center">You don't have any milestones added yet.</h2>
      </td>
    </tr>
  <% else %>

  <tr class='table_header'>
    <th>Name</th>
    <th>Starts at</th>
    <th>Ends at</th>
    <th></th>
    <% if session[:admin_id] != nil %>
      <th></th>
      <th></th>
    <% end %>
  </tr>

<% @milestones.each do |milestone| %>
  <tr class="<%= cycle('alternating_even', 'alternating_odd') -%>">
    <td><%= link_to milestone.name, milestone %></td>
    <td style='text-align:center;'><%= milestone.starts_at.in_time_zone %></td>
    <td style='text-align:center'><%= milestone.ends_at.in_time_zone %></td>
    <% if session[:admin_id] != nil %>
      <td><%= link_to 'Edit', edit_milestone_path(milestone) %></td>
      <td><%= link_to 'Delete', milestone, method: :delete, data: { confirm: 'Are you sure?' } %></td>
    <% end %>
  </tr>
<% end %>
<% end %>
</table>

<script>
  //on dropdown changed value, we will get it's new value, and update our session variable holding time zone to that new value, and refresh the page.
  $('#user_time_zone').bind('change', function() {
      var selected_time_zone_value = $('#user_time_zone').val()

      $.post("/milestones/set_time_zone", {selected_time_zone : selected_time_zone_value}, function(data)
      {
        location.reload();
      });
    });
</script>